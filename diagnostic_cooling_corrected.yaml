# DIAGNÓSTICO COOLING - Problema identificado com detecção de janela

## Problema Principal: 
Você está correto! O `switch.radiator_sala_open_window` é para HABILITAR/DESABILITAR a detecção de janela do TRV, não indica se a janela está aberta.

## Diagnóstico Rápido:

### 1. Execute este template no Developer Tools > Templates:

```yaml
# DIAGNÓSTICO COMPLETO - Substitua pelos seus sensores reais

# Temperaturas
Temp Externa: {{ states('sensor.seu_temp_externa') }}°C
Temp Interna: {{ states('sensor.seu_temp_interna') }}°C

# Zona de conforto (com seus valores: min=18, max=27)
{% set outdoor_temp = states('sensor.seu_temp_externa') | float %}
{% set indoor_temp = states('sensor.seu_temp_interna') | float %}
{% set base_adaptive = (18.9 + 0.255 * outdoor_temp) | round(1) %}
{% set comfort_max = [base_adaptive + 3, 27] | min %}

Zona Conforto Max: {{ comfort_max }}°C
Precisa Cooling?: {{ indoor_temp > comfort_max }}

# Ventilação Natural (PRINCIPAL SUSPEITA)
{% set nat_vent_threshold = 2.0 %}
{% set diff_ext_int = outdoor_temp - indoor_temp %}
Diferença Externa-Interna: {{ diff_ext_int | round(1) }}°C
Threshold Ventilação: {{ nat_vent_threshold }}°C
Ventilação Natural ATIVA: {{ (diff_ext_int >= -nat_vent_threshold) and (diff_ext_int <= nat_vent_threshold) }}

# Estado AC
AC Estado: {{ states('climate.seu_ac') }}
AC Modo: {{ state_attr('climate.seu_ac', 'hvac_mode') }}

# TRV Settings (se configurado)
TRV Detection Switch: {{ states('switch.radiator_sala_open_window') }} (enabled/disabled)
```

### 2. Identifique o sensor REAL de janela aberta do TRV:

No Home Assistant, vá em **Developer Tools → States** e procure por entidades do TRV que podem indicar janela aberta:

```
binary_sensor.radiator_sala_window_detection
binary_sensor.radiator_sala_open_window  
sensor.radiator_sala_window_state
```

### 3. Soluções Imediatas:

**Opção A: Desabilitar Ventilação Natural (Teste Rápido)**
```yaml
natural_ventilation_enable: false
```

**Opção B: Reduzir Threshold da Ventilação**
```yaml
natural_ventilation_threshold: 0.5  # Bem restritivo
```

**Opção C: Verificar TRV Window Detection**
Se encontrar o sensor real de janela, configure:
```yaml
trv_window_open_sensor: binary_sensor.radiator_sala_window_detection
```

## Análise do Seu Cenário:

- Externa: 33.4°C, Interna: 27.5°C
- Diferença: 5.9°C
- Com threshold padrão de 2°C, ventilação natural está DESABILITADA ✓
- Mas pode haver outro problema...

**Execute o diagnóstico e me informe o resultado!**
